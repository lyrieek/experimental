<!DOCTYPE html>
<html>

<head>
<link rel="Stylesheet" type="text/css" href="csdn.detail.css" />
<title>Spring MVC常见bug总结----持续更新中 - CSDN博客</title>
<style type="text/css">
.black {
	margin: 0 12px;
}
</style>
</head>

<body>
	<div>
		<h2 style="background: #cec9c9; padding: 7px 0;">Spring MVC常见bug总结----持续更新中 - CSDN博客</h2>
		<p style="text-align: right;">
			发表时间:2017年07月27日 15:18:34<span class="black"></span>阅读量:115
		</p>
		<hr />
	</div>
	<div class="markdown_views"><p>一、</p> 
<p>&nbsp; Spring MVC的配置文件Springmvc-servlet.xml报错，在添加</p> 
<pre class="html">&lt;context:component-scan base-package="controller" /&gt;</pre>&nbsp; 来指定控制器所在的包时，窗口显示红叉，报错内容为： 
<p></p> 
<p>Multiple annotations found at this line:<br> &nbsp;&nbsp; &nbsp;- schema_reference.4: Failed to read schema document 'http://www.springframework.org/schema/<br> &nbsp;&nbsp; &nbsp; springcontext.xsd', because 1) could not find the document; 2) the document could not be read; 3) the root<br> &nbsp;&nbsp; &nbsp; element of the document is not &lt;xsd:schema&gt;.<br> &nbsp;&nbsp; &nbsp;- cvc-complex-type.2.4.c: The matching wildcard is strict, but no declaration can be found for element<br> &nbsp;&nbsp; &nbsp; 'context:component-scan'.</p> 
<p>&nbsp; 经过检查，发现时springmvc-servlet的头中，关于命名空间（是不是这么说的。。。）的定义有误，导致找不到我对应的文件。</p> 
<p>&nbsp; 之前，我的头定义如下：</p> 
<p>&nbsp; </p> 
<pre class="html">&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	                    http://www.springframework.org/schema/beans/spring-beans.xsd
	                    http://www.springframework.org/schema/mvc
	                    http://www.springframework.org/schema/mvc/spring-mvc.xsd
	                    http://www.springframework.org/schema/context
	                    http://www.springframework.org/schema/springcontext.xsd"&gt;</pre>
<br> xsd等没有指定正确的文件版本，根据自己的jar包版本做修改如下： 
<p></p> 
<p></p> 
<pre class="html">&lt;beans xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd "&gt;</pre>
<br>
<p>二、依然是坑爹的配置bug</p> 
<p>&nbsp;我在实验一个简单的Spring MVC的demo的时候，所有的代码和jar、环境均已经搞定，但是run as server之后，出现：</p> 
<pre class="html">org.xml.sax.SAXParseException; lineNumber: 12; columnNumber: 75; cvc-elt.1: 找不到元素 'beans' 的声明</pre>这样的报错。 
<p></p> 
<p>在实验切xmlns中的文件版本等等方法之后，依然没有效果。但是奇怪的是，我之前一个类似的项目，该配置文件极其类似，只是从传统控制器风格变成了使用注解控制器，程序并没有报错！</p> 
<p>后修改，在beans元素前面加上一个命名空间beans，然后就不报错了。</p> 
<p>前后对比图如下：</p> 
<p>1.发生错误的时候：</p> 
<p></p> 
<pre class="html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc" 
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/mvc 
	    http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/context 
		http://www.springframework.org/schema/context/spring-context-3.0.xsd"&gt;
		
		 
	                
	&lt;mvc:annotation-driven/&gt;   
    &lt;!-- ①：对web包中的所有类进行扫描，以完成Bean创建和自动依赖注入的功能 --&gt;
    &lt;context:component-scan base-package="controller" /&gt;
    &lt;mvc:resources mapping="/*.html" location="/"/&gt;
    
    &lt;bean id="viewResolver"
		class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
	  &lt;property name="prefix" value="/WEB-INF/jsp/" /&gt;
	  &lt;property name="suffix" value=".jsp" /&gt;
	&lt;/bean&gt;
&lt;/beans&gt;</pre>
<br> 2.添加beans命名空间之后： 
<p></p> 
<p></p> 
<pre class="html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans:beans xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd "&gt;
	&lt;mvc:annotation-driven /&gt;
	&lt;!-- ①：对web包中的所有类进行扫描，以完成Bean创建和自动依赖注入的功能 --&gt;
	&lt;context:component-scan base-package="net.use" /&gt;

	&lt;!-- 这两个类用来启动基于Spring MVC的注解功能，将控制器与方法映射加入到容器中 --&gt;
	&lt;beans:bean
		class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping" /&gt;
	&lt;beans:bean
		class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter" /&gt;

	&lt;!-- 这个类用于Spring MVC视图解析 --&gt;
	&lt;beans:bean id="viewResolver"
		class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
		&lt;beans:property name="prefix" value="/WEB-INF/pages/" /&gt;
		&lt;beans:property name="suffix" value=".jsp" /&gt;
	&lt;/beans:bean&gt;
	
&lt;/beans:beans&gt;</pre>不报错了。。。 
<p></p> 
<p>坑爹。。。</p> 
<p>到现在还不知道是什么原因。<br></p> 
<p>3.今天准备尝试一下实现依赖注入，途中发生了一个有趣的bug。</p> 
<p></p>
<pre class="html">严重: Servlet.service() for servlet [s nested exception is org.springframewo</pre>具体的描述没了 
<p>主要是怎么回事呢。</p> 
<p>说表单数据提交后自动绑定到User类的时候发生了一个错误，无法从String对象转换成自己定义的Connection对象。</p> 
<p>恍然想起来，form提交到服务器的全部是String，但是我们自己定义的类的属性可能是double,可能是一个对象。</p> 
<p>所以为了解决这个问题，参考了之前看到的某篇文章，在转成User类之前，先换成一个所有属性都用String表示，属性值和User类一一对应的UserForm类。如下：</p> 
<p></p>
<pre class="java">package net.use.info;

import java.io.Serializable;

import net.use.connection.Connection;

public class User implements Serializable {
	/**
	 * @author zjn
	 */
	private static final long serialVersionUID = 1L;
	private String name; // name
	private String pwd; // pwd
	private Integer age; // age
	
	private String sex;
	
	private Connection connection;//connection是接口
	//全部实现了set和get方法�? 以此完成依赖注入（设值注入）
	public String getSex() {
		return sex;
	}

	public void setSex(String sex) {
		this.sex=sex;
	}


	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public String getPwd() {
		return pwd;
	}

	public void setPwd(String pwd) {
		this.pwd = pwd;
	}

	public Integer getAge() {
		return age;
	}

	public void setAge(Integer age) {
		this.age = age;
	}

	public Connection getConnection() {
		return connection;
	}

	public void setConnection(Connection connection) {
		this.connection = connection;
	}

}</pre>
<br> 然后是userForm类 
<p></p>
<pre class="java">package net.use.form;

public class UserForm {
	private String name; // name
	private String pwd; // pwd
	private Integer age; // age
	
	private String sex;
	
	private String connection;//connection是接口
	private String connection_type;
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public String getPwd() {
		return pwd;
	}
	public void setPwd(String pwd) {
		this.pwd = pwd;
	}
	public Integer getAge() {
		return age;
	}
	public void setAge(Integer age) {
		this.age = age;
	}
	public String getSex() {
		return sex;
	}
	public void setSex(String sex) {
		this.sex = sex;
	}
	public String getConnection() {
		return connection;
	}
	public void setConnection(String connection) {
		this.connection = connection;
	}
	public String getConnection_type() {
		return connection_type;
	}
	public void setConnection_type(String connection_type) {
		this.connection_type = connection_type;
	}
	
	

}
</pre>
<br> 这样，在Controller中，就可以先把Form数据换成UserForm对象，然后再一个一个把属性值赋给User对象。如下： 
<p></p>
<pre class="java">	@RequestMapping("register")
	public String Save(@ModelAttribute("form") UserForm userForm, Model model) { // user:视图层传给控制层的表单对象；model：控制层返回给视图层的对�?
		//model.addAttribute("user", user);
		//System.out.println(user.getName()+","+user.getSex()+","+user.getPwd()+","+user.getAge());
		
		//first,to convert the userform to the user
		User user = new User();
		user.setName(userForm.getName());
		user.setAge(userForm.getAge());
		user.setSex(userForm.getSex());
		user.setPwd(userForm.getPwd());
		
		Connection con;
		if(userForm.getConnection_type().equals("phone")) {
			con = new Phone();
			con.setNumber(userForm.getConnection());
			user.setConnection(con);
		}else if(userForm.getConnection_type().equals("msn")) {
			con = new MSN();
			con.setNumber(userForm.getConnection());
			user.setConnection(con);
		}</pre>
<br> 怪不得之前看的那篇文章要用什么Form类，原来是这个鬼。。。。get！
<br>
<p></p> 
<p><br></p></div>
	<div>
		<hr />
		<p style="text-align: right;">
			抓取时间:2018-01-15 15:10:46<span class="black"></span>作者:<b>qq_28379809</b><span
				class="black"></span>来源:<a href="http://blog.csdn.net/qq_28379809/article/details/76196150">http://blog.csdn.net/qq_28379809/article/details/76196150</a>
		</p>
	</div>
</body>

</html>